
# üõí Laboratorio: Excessive trust in client-side controls

**Plataforma:** PortSwigger Web Security Academy  
**Herramienta de Interceptaci√≥n:** Caido  
**Objetivo:** Explotar una vulnerabilidad de confianza excesiva en los controles del lado del cliente para comprar la chaqueta "Lightweight 'l33t' Leather Jacket" aprovechando un error en la l√≥gica de negocio.

---

## üìù Descripci√≥n de la Vulnerabilidad
La aplicaci√≥n web procesa las compras enviando el precio del producto desde el lado del cliente (navegador) al servidor a trav√©s de una petici√≥n POST. Dado que el servidor no verifica el precio real del producto en su base de datos, conf√≠a ciegamente en el valor proporcionado en la solicitud, permitiendo la manipulaci√≥n del costo final.

## üöÄ Pasos para la Explotaci√≥n

### 1. Autenticaci√≥n
Primero, iniciamos sesi√≥n en la aplicaci√≥n utilizando las credenciales proporcionadas para el laboratorio (`wiener:peter`).

> **[ARRASTRA AQU√ç LA IMAGEN "Login.png"]**

### 2. Exploraci√≥n del Cat√°logo
Navegamos por la p√°gina principal de la tienda en busca de nuestro producto objetivo: la **"Lightweight 'l33t' Leather Jacket"**.

> **[ARRASTRA AQU√ç LA IMAGEN "Pagina_Principal.jpg"]**

Al ver los detalles, confirmamos que el precio original de la chaqueta es de **$1337.00**, lo cual supera nuestro cr√©dito disponible en la tienda.

> **[ARRASTRA AQU√ç LA IMAGEN "Precio.jpg"]**

### 3. Interceptaci√≥n de la Petici√≥n (El inicio del ataque)
Activamos la interceptaci√≥n en **Caido** (modo *Queuing*) y procedemos a agregar la chaqueta al carrito. Al capturar la petici√≥n `POST` a la ruta `/cart`, observamos que el cuerpo de la solicitud incluye el par√°metro `price=133700` (el precio est√° representado en centavos).

> **[ARRASTRA AQU√ç LA IMAGEN "Precio_Inicial.png"]**

### 4. Modificaci√≥n del Par√°metro (Payload)
Para explotar la vulnerabilidad, alteramos directamente el valor del par√°metro `price` dentro de Caido. Cambiamos el valor de `133700` a `1`, lo que equivale a un costo de **$0.01**. Luego, reenviamos (Forward) la petici√≥n al servidor.

> **[ARRASTRA AQU√ç LA IMAGEN "Precio_Modificado.png"]**

El servidor responde con un c√≥digo `302 Found`, indicando que la petici√≥n fue procesada y nos redirige de vuelta a la p√°gina.

> **[ARRASTRA AQU√ç LA IMAGEN "Respuesta_Precio_Modificado.png"]**

### 5. Verificaci√≥n de la Explotaci√≥n
Desactivamos el proxy y nos dirigimos a nuestro carrito de compras. Podemos observar que el sistema confi√≥ en el dato manipulado y ahora la chaqueta se encuentra en nuestro carrito con un precio total de **$0.01**.

*Nota: As√≠ se ver√≠a un carrito normal si no se altera el precio:*

> **[ARRASTRA AQU√ç LA IMAGEN "Carrito_Antes_De_Modificacion_De_Precio.png"]**

*As√≠ se ve nuestro carrito vulnerado:*

> **[ARRASTRA AQU√ç LA IMAGEN "Carrito_Preio_Modificado.png"]**

### 6. Completar la Compra
Hacemos clic en "Place order" para finalizar la compra con nuestro cr√©dito disponible. La compra se procesa exitosamente por $0.01 y el laboratorio es marcado como resuelto.

> **[ARRASTRA AQU√ç LA IMAGEN "Compra_Carrito.png"]**

---

## üõ°Ô∏è Medidas de Mitigaci√≥n
Para prevenir esta vulnerabilidad, el dise√±o de la aplicaci√≥n debe cambiar dr√°sticamente:
1. **Nunca confiar en datos del lado del cliente:** El precio de un producto no debe ser un par√°metro enviado por el usuario.
2. **Validaci√≥n en el Backend:** Al enviar un producto al carrito, el cliente solo debe enviar el `productId` y la `quantity`. El servidor debe consultar el precio real directamente en la base de datos al momento de calcular el total a pagar.

---
*Generado por Santiago Avenda√±o L√≥pez*
